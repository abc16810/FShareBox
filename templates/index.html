<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon" />
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{ title }}</title>
    <meta name="description" content="{{ des }}" />
    <meta name="keywords" content="{{ keywords }}" />
    <meta name="generator" content="FShareBox" />
    <meta name="template" content="V1.0 Beta" />
    <link href="/static/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" />
    <link href="/static/dropzone/dropzone.css" id="bootstrap-style" rel="stylesheet" />
    <link href="/static/css/index.css" rel="stylesheet" />
    <script src="/static/jquery/jquery.min.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script src="/static/dropzone/dropzone-min.js"></script>
</head>

<body style="background-color: #f1f5f9;">
    <div aria-live="polite" aria-atomic="true" class="position-relative">
        <div class="toast-container top-0 end-0 p-3">
            <div id="AlertliveToast" class="toast align-items-center text-bg-warning border-0" role="alert"
                aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                <div class="d-flex">
                    <div class="toast-body" id="alertinfo"></div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Close"></button>
                </div>
            </div>
            <div id="SuccessliveToast" class="toast align-items-center text-bg-success border-0" role="status"
                aria-live="polite" aria-atomic="true" data-bs-delay="5000">
                <div class="d-flex">
                    <div class="toast-body" id="sinfo"></div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Close"></button>
                </div>
            </div>
        </div>
    </div>  
    <div class="main-content">
        <div class="page-content">
            <section class="bg-coming-soon">
                <div class="container">
                    <div class="justify-content-center row">
                        <div class="col-lg-6">
                            <div class="text-center">
                                <img src="/static/img/one.gif" alt="" height="150" class="mg-fluid">
                            </div>
                            <div class="card border-0" style="background-color: #f1f5f9;">
                                <div class="card-header bg-transparent border-bottom-0">
                                    <ul class="nav nav-pills card-header-pills" data-bs-toggle="tabs" id="myTab">
                                        <li class="nav-item">
                                            <a href="#tabs-index" class="nav-link active" data-bs-toggle="tab" id="home-tab">取件</a>
                                        </li>
                                    <li class="nav-item ms-auto">
                                        <a href="#tabs-upload" class="nav-link" data-bs-toggle="tab" id="upload-tab"><!-- Download SVG icon from http://tabler-icons.io/i/activity -->
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16"
                                                height="16" fill="currentColor" class="bi bi-upload"
                                                viewBox="0 0 16 16">
                                                <path
                                                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                                <path
                                                    d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z" />
                                            </svg>
                                        上传</a>
                                    </li>
                                    </ul>
                                </div>
                                <div class="card-body ps-0 pe-0">
                                    <div class="tab-content">
                                        <div class="tab-pane active show ms-auto" id="tabs-index">
                                            <span style="font-size: 20px;">请输入五位取件码</span>    
                                            <form class="me-lg-n15 mt-4 " id="form">
                                                <div class="row g-2 mx-0">
                                                    <div class="col-2 w-10">
                                                        <div class="input-group shadow-sm">
                                                            <input type="text" maxlength=1 id="c1" name="c1"
                                                                class="form-control form-control-lg g-px-8 g-py-15 text-center g-font-size-16">
                                                        </div>
                                                    </div>
                                                    <div class="col-2 w-10">
                                                        <div class="input-group shadow-sm">
                                                            <input type="text" maxlength=1 id="c2" name="c2"
                                                                class="form-control form-control-lg g-px-8 g-py-15 text-center g-font-size-16">
                                                        </div>
                                                    </div>
                                                    <div class="col-2 w-10">
                                                        <div class="input-group shadow-sm">
                                                            <input type="text" maxlength=1 id="c3" name="c3"
                                                                class="form-control form-control-lg g-px-8 g-py-15 text-center g-font-size-16">
                                                        </div>
                                                    </div>
                                                    <div class="col-2 w-10">
                                                        <div class="input-group shadow-sm">
                                                            <input type="text" maxlength=1 id="c4" name="c4"
                                                                class="form-control form-control-lg g-px-8 g-py-15 text-center g-font-size-16">
                                                        </div>
                                                    </div>
                                                    <div class="col-2 w-10">
                                                        <div class="input-group shadow-sm">
                                                            <input type="text" maxlength=1 id="c5" name="c5"
                                                                class="form-control form-control-lg g-px-8 g-py-15 text-center g-font-size-16">
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <div class="row">
                                                <div class="col-auto">
                                                    <div class="mx-auto">
                                                        <a class="btn btn-secondary d-sm-inline-block"
                                                            data-bs-toggle="offcanvas" href="#filesBox" role="button" aria-controls="filesBox">
                                                            取件箱
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="tab-pane" id="tabs-upload">
                                            <div class="row row-cards">
                                                <div class="col-12">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <form id="upload" class="needs-validation" novalidate>
                                                                <div class="mb-3">
                                                                    <div class="row g-2">
                                                                        <div class="col-md-3 col-sm-auto col-smm-auto">
                                                                            <select id="style" class="form-select" name="style" aria-label="Select">
                                                                                <option value="1">次数</option>
                                                                                <option value="2">天数</option>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-md-2 col-sm-auto col-smm-fix">
                                                                            <input type="text" class="form-control" name="value" value="1">
                                                                        </div>
                                                            
                                                                    </div>
                                                                </div>
                                                                <div class="form-selectgroup-boxes row mb-3">
                                                                        <div class="col-lg-6">
                                                                            <label class="form-selectgroup-item">
                                                                                <input type="radio" name="r-type" value="1" class="form-selectgroup-input" id="radio1" checked>
                                                                                <span class="form-selectgroup-label d-flex align-items-center p-3">
                                                                                    <span class="me-3">
                                                                                        <span class="form-selectgroup-check"></span>
                                                                                    </span>
                                                                                    <span class="form-selectgroup-label-content">
                                                                                        <span class="form-selectgroup-title strong mb-1">文件</span>
                                                                                    </span>
                                                                                </span>
                                                                            </label>
                                                                        </div>
                                                                        <div class="col-lg-6">
                                                                            <label class="form-selectgroup-item">
                                                                                <input type="radio" name="r-type" value="2" class="form-selectgroup-input">
                                                                                <span class="form-selectgroup-label d-flex align-items-center p-3">
                                                                                    <span class="me-3">
                                                                                        <span class="form-selectgroup-check"></span>
                                                                                    </span>
                                                                                    <span class="form-selectgroup-label-content">
                                                                                        <span class="form-selectgroup-title strong mb-1">文本</span>
                                                                                    </span>
                                                                                </span>
                                                                            </label>
                                                                        </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <div id="post-text" hidden>
                                                                            <textarea id="text" name="text" class="form-control" rows="5"
                                                                                data-bs-toggle="autosize" placeholder="请输入文本内容…"></textarea>
                                                                        </div>
                                                                        <div id="post-file">
                                                                            <div  class="row py-2">
                                                                                <div class="col-sm-6">
                                                                                    <div class="btn-group">
                                                                                        <span class="btn btn-success fileinput-button">+ 文件</span>   
                                                                                        <button type="reset" class="btn btn-warning col cancel"> 
                                                                                            <span>x 取消</span>
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-sm-6 d-flex align-items-center">
                                                                                    <div class="fileupload-process w-100">
                                                                                        <div id="total-progress" class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                                                                            <div class="progress-bar progress-bar-success" style="width:0%;" data-dz-uploadprogress></div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div id="previews" class="dropzone">
                                                                                <div class="dz-preview dz-file-preview" id="template"> 
                                                                                    <div class="dz-image"><img data-dz-thumbnail /></div>
                                                                                    <div class="dz-details">
                                                                                        <div class="dz-size"><span data-dz-size></span></div>
                                                                                    </div>
                                                                                    <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>
                                                                                    <div class="dz-success-mark"><svg width="54" height="54" fill="#fff"><path d="m10.207 29.793 4.086-4.086a1 1 0 0 1 1.414 0l5.586 5.586a1 1 0 0 0 1.414 0l15.586-15.586a1 1 0 0 1 1.414 0l4.086 4.086a1 1 0 0 1 0 1.414L22.707 42.293a1 1 0 0 1-1.414 0L10.207 31.207a1 1 0 0 1 0-1.414Z"></path></svg></div>
                                                                                    <div class="dz-error-mark"><svg width="54" height="54" fill="#fff"><path d="m26.293 20.293-7.086-7.086a1 1 0 0 0-1.414 0l-4.586 4.586a1 1 0 0 0 0 1.414l7.086 7.086a1 1 0 0 1 0 1.414l-7.086 7.086a1 1 0 0 0 0 1.414l4.586 4.586a1 1 0 0 0 1.414 0l7.086-7.086a1 1 0 0 1 1.414 0l7.086 7.086a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7.086-7.086a1 1 0 0 1 0-1.414l7.086-7.086a1 1 0 0 0 0-1.414l-4.586-4.586a1 1 0 0 0-1.414 0l-7.086 7.086a1 1 0 0 1-1.414 0Z"></path></svg></div>
                                                                                    <div class="dz-error-message"><span data-dz-errormessage></span></div>
                                                                                    <div class="dz-name"><div class="dz-filename"><span data-dz-name></span></div></div> 
                                                                                </div>
                                                                                <div class="dz-default dz-message">
                                                                                    <h3 class="dropzone-msg-title">请单击左上上传按钮选择文件</h3>
                                                                                    <span class="dropzone-msg-desc">最多同时支持3个文件上传</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <div class="card-footer text-end border-0">
                                                            <div class="d-flex">
                                                                <a class="btn btn-secondary" data-bs-toggle="offcanvas" href="#shareEnd" role="button" aria-controls="shareEnd">
                                                                    我的文件箱
                                                                </a>
                                                                <button id="submit" class="btn btn-primary ms-auto">上传</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="offcanvas offcanvas-end" tabindex="-1" id="shareEnd" aria-labelledby="shareEndLabel">
                        <div class="offcanvas-header">
                            <h3 class="offcanvas-title" id="shareEndLabel">我的分享</h3>
                            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                        </div>
                        <div class="offcanvas-body" id="files">
                            <div id="empty">
                                <div class="fs-2 text-center mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-box2" viewBox="0 0 16 16">
                                        <path d="M2.95.4a1 1 0 0 1 .8-.4h8.5a1 1 0 0 1 .8.4l2.85 3.8a.5.5 0 0 1 .1.3V15a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V4.5a.5.5 0 0 1 .1-.3L2.95.4ZM7.5 1H3.75L1.5 4h6V1Zm1 0v3h6l-2.25-3H8.5ZM15 5H1v10h14V5Z" />
                                    </svg>
                                </div>
                                <h2 class="fs-5 text-center" style="color: rgba(30,41,59,.7);">你还没有分享文件，单击上传按钮上文件</h2>
                            </div>
                            <div id="list-items" class="d-none list-group list-group-flush list-group-hoverable">
                            </div>
                        </div>
                    </div>
                    <div class="offcanvas offcanvas-end" tabindex="-1" id="filesBox" aria-labelledby="filesBoxLabel">
                        <div class="offcanvas-header">
                            <h3 class="offcanvas-title" id="filesBoxLabel">收件箱</h3>
                            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                        </div>
                        <div class="offcanvas-body" id="rece-files">
                            <div id="rece-empty">
                                <div class="fs-2 text-center mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-box2" viewBox="0 0 16 16">
                                        <path
                                            d="M2.95.4a1 1 0 0 1 .8-.4h8.5a1 1 0 0 1 .8.4l2.85 3.8a.5.5 0 0 1 .1.3V15a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V4.5a.5.5 0 0 1 .1-.3L2.95.4ZM7.5 1H3.75L1.5 4h6V1Zm1 0v3h6l-2.25-3H8.5ZM15 5H1v10h14V5Z" />
                                    </svg>
                                </div>
                                <h2 class="fs-5 text-center" style="color: rgba(30,41,59,.7);">请输入取件码，收取文件</h2>
                            </div>
                            <div id="rece-list-items" class="d-none">
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</body>
<script src="/static/js/index.js"></script>
<script type="text/javascript">
const tabl = document.querySelector('#home-tab')
const tab2 = document.querySelector('#upload-tab')
tabl.addEventListener('shown.bs.tab', event => {
   $('#form')[0].reset();
   console.log(document.querySelector("input[type='radio']:checked").value)
})
tab2.addEventListener('shown.bs.tab', event => {
    $('#upload')[0].reset();
    const t = document.querySelector("input[type='radio']:checked").value
    if (t === "1"){
        if (typeof($("#post-file").attr("hidden")) != "undefined"){
        $("#post-text").attr("hidden", "hidden");
        $("#post-file").removeAttr("hidden");
    }    
   }
})
</script>
<script type="text/javascript">

    // DropzoneJS Demo Code Start
    Dropzone.autoDiscover = false

    let previewNode = document.querySelector("#template")
    previewNode.id = ""
    let previewTemplate = previewNode.parentNode.innerHTML
    previewNode.parentNode.removeChild(previewNode)

    let myDropzoneFile = new Dropzone('div#previews', { // Make the whole body a dropzone
        url: '/api/share', // Set the url
        disablePreviews: false, //开启预览
        autoProcessQueue: false,
        uploadMultiple: true,
        parallelUploads: 3,   //并行处理多少文件上传
        maxFilesize: 256,  //byte
        maxFiles: 3,   //最大允许上传3个文件
        //paramName: 'file',  //用于传输文件的field名称 多个文件默认为file[0]  file[1] 通过如下函数改为file
        paramName: function(n){
            return "file"
        },
        previewTemplate: previewTemplate,
        previewsContainer: "#previews", // Define the container to display the previews
        clickable: ".fileinput-button", // Define the element that should be used as click trigger to select files.
        init: function() {
            var myDropzone = this;
            document.querySelector("#submit").addEventListener("click", function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (myDropzoneFile.getAcceptedFiles().length !== 0 ){
                    myDropzoneFile.processQueue();
                } 
                
            });
            this.on('sending', function (file, xhr, formData) {
                // Append all form inputs to the formData Dropzone will POST
                var data = $('#upload').serializeArray();
                $.each(data, function (key, el) {
                    if (! formData.has(el.name)){
                        formData.append(el.name, el.value);
                    }
                });
                console.log(formData);

            });
            this.on("sendingmultiple", function() {
            });
            this.on("successmultiple", function(files, response) {
                ShowSToast("上传成功")
                $("#empty").addClass("d-none");
                $("#list-items").removeClass("d-none");
                get_share_files("list-items", response.data)
                new bootstrap.Offcanvas('#shareEnd').show()
                
            });
            this.on("errormultiple", function(files, response) {
                ShowAToast("上传失败")
            });
        },
        error: function (file, response){
            if ($.type(response) === "string")
                var message = response; //dropzone sends it's own error messages in string
            else
                var message = response.detail;
            file.previewElement.classList.add("dz-error");
            _ref = file.previewElement.querySelectorAll("[data-dz-errormessage]");
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                node = _ref[_i];
                _results.push(node.textContent = message);
            }
            return _results;
        },
        reset: function () {
            //console.log("resetFiles");
        this.removeAllFiles(true);
        }
    })

    myDropzoneFile.on("addedfile", file => {
        console.log("A file has been added");
    })

    myDropzoneFile.on("totaluploadprogress", function(progress) {
        document.querySelector("#total-progress .progress-bar").style.width = progress + "%"
    })
    // myDropzoneFile.on("sending", function(file) {
    //     // Show the total progress bar when upload starts
    // })
    // myDropzoneFile.on("queuecomplete", function(progress) {
    // })

    document.querySelector("#submit").onclick = function() {
        const text = document.querySelector('#text').value;
        const t = document.querySelector("input[type='radio']:checked").value;
        if(t === "2" && text != ""){
            var form = new FormData(document.getElementById("upload"));
                $.ajax({
                    type: 'post',
                    url: '/api/share',
                    data: form,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        ShowSToast("上传成功")
                        $("#empty").addClass("d-none");
                        $("#list-items").removeClass("d-none");
                        get_share_files("list-items", response.data)
                        new bootstrap.Offcanvas('#shareEnd').show()
                    },
                    error: function (data) {
                        if (data.responseJSON == undefined) {
                            ShowAToast("上传失败")
                        } else {
                            var info = data.responseJSON.detail;
                            ShowAToast(info)
                        }
                    }
                })
        } 
      }

  document.querySelector("#post-file .cancel").onclick = function() {
    myDropzoneFile.removeAllFiles(true)
    document.querySelector("#total-progress .progress-bar").style.width =  "0%"
  }

  $(document).ready(function () { 
        $("input[name^='c']").val("");
        $("#c1").focus();
        $("input[type='radio']").change(function () {
            if (this.value == "1") {
                //$("#text").attr("disabled", "disabled");
                $("#post-text").attr("hidden", "hidden");
                $("#post-file").removeAttr("hidden");
                $('#text').val("")
            } else {
                $("#post-file").attr("hidden", "hidden");
                $("#post-text").removeAttr("hidden");
                myDropzoneFile.removeAllFiles(true)
                document.querySelector("#total-progress .progress-bar").style.width =  "0%"
            }
        });
    })
</script>
</html>